### __Seed builder__
#   Autogenerated jobs
#   Add custom jobs at the end

name: Deployment

on:
  push:
    branches: [main, master]

  pull_request:
    branches:
      - [main, master]

jobs:

  test:
    uses: ./.github/workflows/test_wf.yml

  deploy:
    name: deploy
    runs-on: ubuntu-latest
    needs: [test]

    steps:
      - name: Setup pem
        id: setup-pem
        env:
          PRIVATE_KEY: ${{ secrets.PEM }}
          DEPLOY: ${{ secrets.ENABLE_DEPLOY }}
        if: env.DEPLOY == 'True'
        run:
          echo "$PRIVATE_KEY" >> $HOME/key.pem && chmod 400 $HOME/key.pem

      - name: Update server
        env:
          DEPLOY: ${{ secrets.ENABLE_DEPLOY }}
        if: env.DEPLOY == 'True'
        run:
          ssh -i $HOME/key.pem -o StrictHostKeyChecking=no ${{ secrets.USER }}@${{ secrets.SERVER }} './deploy.sh ${{ secrets.GIT_PATH }'

# __End autogenerated__
# Include jobs after this block
###